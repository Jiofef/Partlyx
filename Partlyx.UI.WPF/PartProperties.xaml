<UserControl x:Class="Partlyx.UI.WPF.PartProperties"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:beh="clr-namespace:Partlyx.UI.WPF.Behaviors"
             xmlns:local="clr-namespace:Partlyx.UI.WPF"
             xmlns:h="clr-namespace:Partlyx.UI.WPF.Helpers"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop"
             xmlns:vmprop="clr-namespace:Partlyx.ViewModels.ItemProperties;assembly=Partlyx.ViewModels"
             xmlns:ddlocal="clr-namespace:Partlyx.UI.WPF.DragAndDrop"
             xmlns:fa="clr-namespace:Meziantou.WpfFontAwesome;assembly=Meziantou.WpfFontAwesome">
    <UserControl.Resources>
        <DataTemplate DataType="{x:Type vmprop:TextBoxItemPropertyViewModel}">
            <Grid Margin="4,2,4,2" Height="36" HorizontalAlignment="Stretch">
                <Rectangle RadiusX="8" RadiusY="8" Fill="{StaticResource PxWhiteBrush}" HorizontalAlignment="Stretch"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid.InputBindings>
                        <MouseBinding Gesture="LeftClick" Command="{Binding StartTypingCommand}"/>
                    </Grid.InputBindings>

                    <TextBlock Text="{Binding DisplayableName}" Grid.Column="0" VerticalAlignment="Center" Style="{StaticResource CommonTextBlock}" Margin="4"/>

                    <TextBlock Text="{Binding Text, Mode=OneWay}" Grid.Column="1" VerticalAlignment="Center" Style="{StaticResource CommonTextBlock}" Background="{StaticResource PxWhiteBrush}"
                               Margin="4" Visibility="{Binding IsChangingText, Converter = {StaticResource InverseBoolToVisConv}}">
                    </TextBlock>

                    <TextBox Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" Grid.Column="1" VerticalAlignment="Center" Style="{StaticResource CommonTextBox}"
                             Background="{StaticResource PxWhiteBrush}" BorderBrush="{StaticResource PxBlue0Brush}" BorderThickness="2"
                             Margin="4" Visibility="{Binding IsChangingText, Converter={StaticResource BoolToVisConv}}" FontFamily="Cascadia Code">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding ConfirmChangesCommand}" CommandParameter="{Binding Text}"/>
                            <KeyBinding Key="Esc" Command="{Binding CancelChangesCommand}"/>
                        </TextBox.InputBindings>
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="LostKeyboardFocus">
                                <i:InvokeCommandAction Command="{Binding ConfirmChangesCommand}" CommandParameter="{Binding Text}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        
                        <i:Interaction.Behaviors>
                            <beh:FocusBehavior IsFocused="{Binding IsChangingText, Mode=TwoWay}"/>
                        </i:Interaction.Behaviors>
                    </TextBox>
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vmprop:RecipeItemPropertyViewModel}">
            <Grid Height="36" HorizontalAlignment="Stretch" Margin="4">
                <Rectangle RadiusX="8" RadiusY="8" Fill="{StaticResource PxWhiteBrush}" HorizontalAlignment="Stretch"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding DisplayableName}" Grid.Column="0" VerticalAlignment="Center" Style="{StaticResource CommonTextBlock}" Margin="4"/>
                    <TextBlock Text="{Binding Part.Name, Mode=OneWay}" Grid.Column="1" VerticalAlignment="Center" Style="{StaticResource CommonTextBlock}" Background="{StaticResource PxWhiteBrush}" Margin="4"/>

                    <Button Content="Select" Style="{StaticResource BaseButtonStyleDarkerFocus}" Command="{Binding SelectButtonPressedCommand}" Grid.Column="2" Width="auto" />
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vmprop:SpinBoxItemPropertyViewModel}">
            <Grid Height="36" HorizontalAlignment="Stretch" Margin="4">
                <Rectangle RadiusX="8" RadiusY="8" Fill="{StaticResource PxWhiteBrush}" HorizontalAlignment="Stretch"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding DisplayableName}" Grid.Column="0" VerticalAlignment="Center" Style="{StaticResource CommonTextBlock}" Margin="4"/>
                    <md:DecimalUpDown Value="{Binding Value, Mode=TwoWay}" Grid.Column="1" VerticalAlignment="Center" Margin="4">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="ValueChanged">
                                <i:InvokeCommandAction
                                                        Command="{Binding SaveChangesCommand}"
                                                        CommandParameter="{Binding Value}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </md:DecimalUpDown>
                </Grid>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>
    <Grid Background="{StaticResource PxBlue0Brush}" HorizontalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <StackPanel Orientation="Vertical" Grid.Row="0">
            <Grid Height="48">
                <Rectangle Fill="{StaticResource PxBlue0Brush}" RadiusX="8" RadiusY="8" StrokeThickness="4" Stroke="{StaticResource PxBlue1Brush}"/>
                <TextBlock Text="{h:Loc Properties}" Foreground="{StaticResource PxBlackBrush}" FontSize="32" TextAlignment="Center" FontStyle="Italic" DockPanel.Dock="Top"/>
            </Grid>
            <TextBlock Grid.Row="0" Text="{Binding FocusedPartTextAnnotation}" Margin="8, 4, 8, 4" HorizontalAlignment="Center" Foreground="{StaticResource PxBlackBrush}" Style="{StaticResource CommonTextBlock}"/>
            <ListView x:Name="PropertiesListView" ItemsSource="{Binding Properties}" HorizontalContentAlignment="Stretch">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ContentControl>
                            <ContentPresenter Content="{Binding}"/>
                        </ContentControl>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackPanel>
    </Grid>
</UserControl>
